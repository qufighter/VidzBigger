<html>
  <script>
  	
  	String.prototype.qreplace=function(qsearch,qreplace){
			return this.split(qsearch).join(qreplace);
		};
  	String.prototype.qslice=function(before,after){
			var s=this.indexOf(before)+before.length; 
			var n=this.indexOf(after,s);
			if(n<0)return this.substr(s);
			return this.substr(s,n-s);
		}

  	function _ge(g){
			return document.getElementById(g);
		}
  	
  	function ctn(tex){
  		return document.createTextNode(tex);
  	}
  	
  	//appnedTo should ONLY be specified on the last element that needs to be created
  	//				which means the TOP level element (or the final parameter on the first one)
  	function cel(typ,attributes,addchilds,appnedTo){
  		var ne=document.createElement(typ);
  		for( i in attributes ){
  			if( i == 'events' ){
  				//if(!pendingListenrs[ne])pendingListenrs[ne]=[];
  				pendingListenrs.push([ne,attributes[i]]);
  			}else if( i == 'checked'){
  				if(attributes[i])ne.setAttribute(i,'checked');
  			}else ne.setAttribute(i,attributes[i]);
  		}
  		if(addchilds){
  			for( i in addchilds ){
	  			ne.appendChild(addchilds[i]);
	  		}
  		}
  		if(appnedTo){
  			appnedTo.appendChild(ne);
  			for( i in pendingListenrs ){
  				pendingListenrs[i][0].addEventListener(pendingListenrs[i][1][0],pendingListenrs[i][1][1],pendingListenrs[i][1][2]?pendingListenrs[i][1][2]:false)
  			}
  			pendingListenrs=[]
  		}
  		return ne;
  		//identifier unexpected means your missing a comma on the row before
  	}
  	var pendingListenrs=[];
  	
  	var share_enabled = false;
  	var murl='http://www.vidzbigger.com/videoSimpleList.php?page='
  	var page=1;
  	function corretPage(){
  		var np = page;
  		var cr = _ge('mainscreen').src
  		console.log(cr);
  		if( cr != murl+page ){
  			np = cr.qslice('page=','&') - 0;
  			console.log('nepage '+np);
  			if(np<1)np=page;
  		}
  		page=np;
  	}
  	function advance(){
  		_ge('browser').innerHTML="L O A D I N G";
  		//corretPage();
  		//_ge('mainscreen').src='loading.html';
  		page++;
  		window.setTimeout(loadpage,250);
  	}
  	function devance(){
  		_ge('browser').innerHTML="L O A D I N G";
  		//corretPage();
  		//_ge('mainscreen').src='loading.html';
  		page--;
  		if(page<1)page=1;
  		window.setTimeout(loadpage,250);
  	}
  	function loadpage(){
  		loadBrowserURL();
  		//_ge('mainscreen').src = murl+page;
  		
  	}
  	function clickedbrowser(ev){
  		t=ev.target;
  		if(t.tagName!='A')t=t.parentNode
  		if(t.tagName=='A'){
  			
  			if(ev.which==2 || t.target=='_top'){
					  	chrome.tabs.create({url:t.href}, function(t){});
  			}else{
	  			chrome.tabs.getSelected(null, function(tab) {
					  	chrome.tabs.update(tab.id, {url:t.href,selected:false}, function(t){});
	  			});
  			}
  		}
  	}
  	function domore(){
  		if( !share_enabled ){
  			
  			cel('div',{},[
  			
	  			//cel('div',{},[
						cel('input',{'type':'button','value':'Last Page','events':['click',devance]}),
						cel('input',{'type':'button','value':'Next Page','events':['click',advance]}),
					//]),
	  			
		  		cel('div',{'style':'min-width:600px;','id':'browser','events':['click',clickedbrowser]},[
			  				ctn("L O A D I N G"),
	
		  		
		  		
	//	  			cel('iframe',{'id':'mainscreen','style':'width:550px;height:300px;','src':'loading.html'}),
	//	  			cel('div',{},[
	//						cel('input',{'type':'button','value':'Last Page','events':['click',devance]}),
	//						cel('input',{'type':'button','value':'Next Page','events':['click',advance]})
	//					])
		
		
			  	]),
			  	
			  	//cel('div',{},[
						cel('input',{'type':'button','value':'Last Page','events':['click',devance]}),
						cel('input',{'type':'button','value':'Next Page','events':['click',advance]})
					//]),
		  	
		  	],_ge('viewr'));
		  	
				loadBrowserURL()
		  	
		  	share_enabled=true;
		  }else{
		  	_ge('viewr').removeChild(_ge('viewr').firstChild);
		  	share_enabled=false;
		  }
	  	window.setTimeout(loadpage,250);
  	}
  	
  	function loadBrowserURL(){
  		chrome.extension.sendRequest({'url':murl+page,'method':'GET','msgType':"G_xmlhttpRequest"}, function(response){
	  		if(response.responseText.length > 0 )
	  			_ge('browser').innerHTML=response.responseText.qslice('<!--VZB_B-->','<!--VZB_E-->').qreplace('"img/','"http://www.vidzbigger.com/img/');
	  		else
	  			_ge('browser').innerHTML='Error - Check internet connection';
	  	});
  	}
  	
  	function doit(){
  		document.body.removeChild(document.body.firstChild);
  		
  		//check setting
  		
  		
  		if( share_enabled ){
  			
  		}else{
  			cel('div',{'style':'min-width:200px;'},[
  				cel('div',{'id':'viewr'},[
  				
//cel('iframe',{'id':'mainscreen','style':'width:500px;height:500px;','src':'loading.html'})
  			
		  		]),
  				cel('div',{'class':'prow'},[
		  			cel('label',{},[
		  				cel('input',{'type':'checkbox','events':['click',domore],'checked':share_enabled}),
		  				ctn("Participate in View Sharing")
		  			])
		  		]),
//		  		cel('div',{'class':'prow'},[
//		  			cel('label',{},[
//		  				cel('input',{'type':'checkbox','events':['click',domore]}),
//		  				ctn("Use Encrypted Transmission")
//		  			])
//		  		]),
		  		cel('div',{'class':'prow'},[
		  			cel('label',{},[
		  				ctn("VidzBigger "),
		  				cel('input',{'type':'button','value':'Preferences','events':['click',domore]})
		  			])
		  		])
	  		],document.body);
  		}
  	}
  </script>
  <body onload="doit()" style="margin:0px;padding:0px;><pre>
 		<a href="http://vidzbigger.com/contact">vidzbigger.com/contact</a>
  </pre></body>
</html>